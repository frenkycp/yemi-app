<?php
// This class was automatically generated by a giiant build task
// You should not change it manually as it will be overwritten on next build

namespace app\controllers;

use yii\web\Controller;
use app\models\UncountableView02;
use dmstr\bootstrap\Tabs;
use yii\helpers\Url;

/**
 * 
 */
class PartsUncountableMonthlyReportController extends Controller
{
	public function actionIndex()
	{
		$data = [];

		$get_data_arr = UncountableView02::find()
		//->where(['>=', 'PERIOD', '201808'])
		->orderBy('ITEM, POST_DATE')
		->all();

		$item_desc_arr = [
			'Q825YL07000' => 'CLEARSHOT LIQUID FOR FUSION GUN',
			'WT92881' => 'LINE-X ISOCYANATE SE-210 : BLACK',
			'WU27851' => 'LINE-X RESIN SE-BK210 : BLACK',
			'WY69990' => 'MDF T15 4X8 HUME CARB P2',
		];

		$panel_class = 'info';

		foreach ($get_data_arr as $key => $value) {
			$partno = $value->ITEM;
			$post_date = (strtotime("$value->POST_DATE +3 hours") * 1000);
			//$post_date = $value->POST_DATE;
			$ending_qty = $value->ENDING_QTY;
			$wh_ending_qty = $value->WH_ENDING_QTY;
			$deviasi = $value->DEVIASI_PERCENT;

			$deviasi_color = 'rgba(0, 255, 0, 0.9)';
			if ($value->DEVIASI_PERCENT >= 30) {
				$deviasi_color = 'rgba(255, 0, 0, 0.9)';
			}

			if ($wh_ending_qty < 5000) {
				//$panel_class = 'danger';
			} elseif ($wh_ending_qty < 10000) {
				//$panel_class = 'warning';
			}

			if (!isset($data[$partno]['item_desc'])) {
				$data[$partno]['item_desc'] = $value->ITEM_DESC;
			}

			if (!isset($data[$partno]['uom'])) {
				$data[$partno]['uom'] = $value->UOM;
			}

			$data[$partno]['panel_class'] = $panel_class;

			$data[$partno]['categories'][] = $post_date;
			$data[$partno]['data1'][] = [
				$post_date,
				(int)$ending_qty
			];
			$data[$partno]['data2'][] = [
				$post_date,
				(int)$wh_ending_qty
			];
			$data[$partno]['deviasi'][] = [
				'x' => $post_date,
				'y' => (float)$deviasi,
				'color' => $deviasi_color
			];
		}

		return $this->render('index', [
			'data' => $data,
		]);
	}
}